<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | {{ site_name }} 分享页</title>
    <meta name="description" content="{{ excerpt or title }}">
    <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
    <meta name="theme-color" content="#08111f">
    <meta name="application-name" content="{{ site_name }}">
    <meta name="apple-mobile-web-app-title" content="{{ site_name }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="{{ site_name }}">
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ excerpt or title }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ canonical_url }}">
    {% if published_at %}
    <meta property="article:published_time" content="{{ published_at }}">
    <meta property="article:modified_time" content="{{ published_at }}">
    {% endif %}
    <meta name="twitter:card" content="{% if og_image_url %}summary_large_image{% else %}summary{% endif %}">
    <meta name="twitter:title" content="{{ title }}">
    <meta name="twitter:description" content="{{ excerpt or title }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <link rel="alternate" hreflang="zh-CN" href="{{ canonical_url }}">
    {% if og_image_url %}
    <meta property="og:image" content="{{ og_image_url }}">
    <meta name="twitter:image" content="{{ og_image_url }}">
    {% endif %}
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="icon" href="{{ url_for('static', filename='favicon-32.png') }}" sizes="32x32" type="image/png">
    <link rel="icon" href="{{ url_for('static', filename='favicon-16.png') }}" sizes="16x16" type="image/png">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:opsz,wght@6..72,500;6..72,700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/share.css">
    <script type="application/ld+json">{{ structured_data | tojson }}</script>
</head>
<body>
    <div class="share-shell">
        <main class="share-stage">
            <div class="share-article">
                {{ article_html | safe }}
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <script>
        (async () => {
            const nodes = Array.from(document.querySelectorAll('.md2-mermaid[data-mermaid]'));
            if (!nodes.length || !window.mermaid) {
                return;
            }

            window.mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: 'neutral'
            });

            for (const [index, node] of nodes.entries()) {
                try {
                    const source = new TextDecoder().decode(
                        Uint8Array.from(atob(node.dataset.mermaid), (char) => char.charCodeAt(0))
                    );
                    const result = await window.mermaid.render(`share-mermaid-${index}`, source);
                    node.innerHTML = result.svg;
                    node.removeAttribute('data-mermaid');
                } catch (error) {
                    node.innerHTML = '<div class="mermaid-error">Mermaid 渲染失败，请检查图表语法。</div>';
                }
            }
        })();
    </script>
</body>
</html>
