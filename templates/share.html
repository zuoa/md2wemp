<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | MD2WE 分享页</title>
    <meta name="description" content="{{ excerpt or title }}">
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ excerpt or title }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ share_url }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:opsz,wght@6..72,500;6..72,700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/share.css">
</head>
<body>
    <div class="share-shell">
        <main class="share-stage">
            <div class="share-article">
                {{ article_html | safe }}
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <script>
        (async () => {
            const nodes = Array.from(document.querySelectorAll('.md2-mermaid[data-mermaid]'));
            if (!nodes.length || !window.mermaid) {
                return;
            }

            window.mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: 'neutral'
            });

            for (const [index, node] of nodes.entries()) {
                try {
                    const source = new TextDecoder().decode(
                        Uint8Array.from(atob(node.dataset.mermaid), (char) => char.charCodeAt(0))
                    );
                    const result = await window.mermaid.render(`share-mermaid-${index}`, source);
                    node.innerHTML = result.svg;
                    node.removeAttribute('data-mermaid');
                } catch (error) {
                    node.innerHTML = '<div class="mermaid-error">Mermaid 渲染失败，请检查图表语法。</div>';
                }
            }
        })();
    </script>
</body>
</html>
